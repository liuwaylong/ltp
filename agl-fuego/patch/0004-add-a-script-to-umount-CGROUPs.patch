From c13f6d7a82652528138e92b176cdcb0ad979e076 Mon Sep 17 00:00:00 2001
From: Liu Wenlong <liuwl.fnst@cn.fujitsu.com>
Date: Mon, 31 Jul 2017 09:37:59 -0400
Subject: [PATCH] controllers: add a script to umount CGROUPs

The controllers related cases need to clean the CGROUPs first
before testing.
For most distri, CGROUPs were mounted automatically which need to
be unmounted first before test start.

Signed-off-by: Liu Wenlong <liuwl.fnst@cn.fujitsu.com>
---
 testscripts/cgroup_umount.sh | 24 ++++++++++++++++++++++++
 1 file changed, 24 insertions(+)
 create mode 100755 testscripts/cgroup_umount.sh

diff --git a/testscripts/cgroup_umount.sh b/testscripts/cgroup_umount.sh
new file mode 100755
index 0000000..a0aac41
--- /dev/null
+++ b/testscripts/cgroup_umount.sh
@@ -0,0 +1,24 @@
+#!/bin/sh
+
+echo "start umount ..."
+# cgroup directory umount
+grep "/sys/fs/cgroup/" /proc/mounts | grep -v systemd | \
+                                              awk '{print $2}' > all_cgroup
+while read dir; do
+	cd $dir
+	for line in `find -type d | grep -v '^.$' | sort -r`; do
+		cd $line
+		while read pid; do
+			echo $pid > $dir/tasks
+		done < tasks
+		cd - > /dev/null
+		rmdir $line
+		if [ $? -ne 0 ]; then
+			cat $line/tasks
+			rm -f $line/tasks
+			rmdir $line
+		fi
+	done
+	cd $ltp_dir
+	umount $dir
+done < all_cgroup
-- 
2.7.4

